<!DOCTYPE html>
<html>
<head>
    <title>Edit Purchase Order</title>
    <style>
        label { display: block; margin-top: 10px; }
        input, select { width: 300px; padding: 5px; }
        .form-group { margin-bottom: 15px; }
    </style>
</head>
<body>
    <h2>Edit Purchase Order: {{ po['po_id'] }}</h2>
    <form method="post">
        <div class="form-group">
            <label>Client Name:</label>
            <input type="text" name="client_name" value="{{ po['client_name'] }}" required>
        </div>
        <div class="form-group">
            <label>Amount:</label>
            <input type="number" step="0.01" name="amount" value="{{ po['amount'] }}" required>
        </div>
        <div class="form-group">
            <label>Status:</label>
            <input type="text" name="status" value="{{ po['status'] }}" required>
        </div>
        <div class="form-group">
            <label>Payment Terms:</label>
            <input type="number" name="payment_terms" value="{{ po['payment_terms'] }}">
        </div>
        <div class="form-group">
            <label>Payment Type:</label>
            <select name="payment_type" id="payment_type">
                <option value="milestone" {% if po['payment_type'] == 'milestone' %}selected{% endif %}>Milestone</option>
                <option value="distributed" {% if po['payment_type'] == 'distributed' %}selected{% endif %}>Distributed</option>
                <option value="periodic" {% if po['payment_type'] == 'periodic' %}selected{% endif %}>Periodic</option>
            </select>
        </div>
        <div class="form-group">
            <label>Start Date:</label>
            <input type="text" name="start_date" value="{{ po['start_date'] }}">
        </div>
        <div class="form-group">
            <label>End Date:</label>
            <input type="text" name="end_date" value="{{ po['end_date'] }}">
        </div>
        <div class="form-group">
            <label>Duration (months):</label>
            <input type="number" name="duration_months" value="{{ po['duration_months'] }}">
        </div>

        <!-- Payment Frequency for periodic -->
        {% if po['payment_type'] == 'periodic' %}
        <div class="form-group">
            <label>Payment Frequency:</label>
            <input type="number" name="payment_frequency" value="{{ po['payment_frequency'] }}">
        </div>
        {% endif %}

        <!-- Milestones for milestone type -->
        {% if po['payment_type'] == 'milestone' %}
        <div class="form-group">
            <label>Milestones:</label>
            <div id="milestones-list">
                {% for ms in po['milestones'] %}
                <div class="milestone-entry">
                    <input type="text" name="milestone_name" placeholder="Name" value="{{ ms['milestone_name'] }}" required>
                    <input type="text" name="milestone_description" placeholder="Description" value="{{ ms['milestone_description'] }}">
                    <input type="text" name="milestone_due_date" placeholder="Due Date" value="{{ ms['milestone_due_date'] }}">
                    <input type="number" step="0.01" name="milestone_percentage" placeholder="%" value="{{ ms['milestone_percentage'] }}" required>
                    <button type="button" onclick="removeMilestone(this)">Remove</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" onclick="addMilestone()">Add Milestone</button>
        </div>
        {% endif %}

        <!-- Payment Schedule for distributed type -->
        {% if po['payment_type'] == 'distributed' %}
        <div class="form-group">
            <label>Payment Schedule:</label>
            <div id="schedule-list">
                {% for sched in po['payment_schedule'] %}
                <div class="schedule-entry">
                    <input type="text" name="payment_date" placeholder="Date (DD-MM-YYYY)" value="{{ sched['payment_date'] }}" required>
                    <input type="number" step="0.01" name="payment_amount" placeholder="Amount (USD)" value="{{ sched['payment_amount'] }}" required>
                    <input type="text" name="payment_description" placeholder="Description" value="{{ sched['payment_description'] }}">
                    <button type="button" onclick="removeSchedule(this)">Remove</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" onclick="addSchedule()">Add Payment</button>
        </div>
        {% endif %}

        <button type="submit">Save</button>
        <a href="{{ url_for('forecast') }}">Cancel</a>
    </form>

    <script>
    document.getElementById('payment_type').addEventListener('change', function () {
        const value = this.value;
        document.querySelectorAll('.form-group').forEach(group => {
            if (group.classList.contains('milestone-fields') || group.classList.contains('schedule-fields') || group.classList.contains('payment-frequency')) {
                group.style.display = 'none';
            }
        });
        if (value === 'milestone') {
            document.querySelector('.milestone-fields').style.display = 'block';
        } else if (value === 'distributed') {
            document.querySelector('.schedule-fields').style.display = 'block';
        } else if (value === 'periodic') {
            document.querySelector('.payment-frequency').style.display = 'block';
        }
    });

    function addMilestone() {
        const container = document.getElementById('milestones-list');
        const div = document.createElement('div');
        div.className = 'milestone-entry';
        div.innerHTML = `
            <input type="text" name="milestone_name" placeholder="Name" required>
            <input type="text" name="milestone_description" placeholder="Description">
            <input type="text" name="milestone_due_date" placeholder="Due Date">
            <input type="number" step="0.01" name="milestone_percentage" placeholder="%" required>
            <button type="button" onclick="removeMilestone(this)">Remove</button>
        `;
        container.appendChild(div);
    }
    function removeMilestone(btn) {
        btn.parentElement.remove();
    }
    function addSchedule() {
        const container = document.getElementById('schedule-list');
        const div = document.createElement('div');
        div.className = 'schedule-entry';
        div.innerHTML = `
            <input type="text" name="payment_date" placeholder="Date (DD-MM-YYYY)" required>
            <input type="number" step="0.01" name="payment_amount" placeholder="Amount (USD)" required>
            <input type="text" name="payment_description" placeholder="Description">
            <button type="button" onclick="removeSchedule(this)">Remove</button>
        `;
        container.appendChild(div);
    }
    function removeSchedule(btn) {
        btn.parentElement.remove();
    }
    </script>
</body>
</html>
