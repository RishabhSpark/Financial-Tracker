<!DOCTYPE html>
<html>
  <head>
    <title>PO Sync Dashboard</title>
    <style>
      .table {
        border-collapse: collapse;
        width: 100%;
      }
      .table th,
      .table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <h2>ðŸ“Š Forecast Pivot Table</h2>
    <form method="get" action="/forecast" style="margin-bottom: 20px;">
      <label for="client_name">Client Name:</label>
      <select name="client_name" id="client_name">
        <option value="">All</option>
        {% for name in client_names %}
          <option value="{{ name }}" {% if name == selected_client %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
      &nbsp;&nbsp;
      <label for="po_no">PO No:</label>
      <select name="po_no" id="po_no">
        <option value="">All</option>
        {% for po in po_nos %}
          <option value="{{ po }}" {% if po == selected_po %}selected{% endif %}>{{ po }}</option>
        {% endfor %}
      </select>
      &nbsp;&nbsp;
      <label for="start_month">Start Month:</label>
      <select name="start_month" id="start_month">
        <option value="">Any</option>
        {% for m in months %}
          <option value="{{ m }}" {% if m == selected_start_month %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
      </select>
      &nbsp;&nbsp;
      <label for="end_month">End Month:</label>
      <select name="end_month" id="end_month">
        <option value="">Any</option>
        {% for m in months %}
          <option value="{{ m }}" {% if m == selected_end_month %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
      </select>
      &nbsp;&nbsp;
      <button type="submit">Apply Filters</button>
      <button type="button" onclick="location.href='/refresh_charts'">Refresh Charts</button>
      <button type="button" onclick="location.href='/download_xlsx'">Download XLSX</button>
    </form>
    <div>{{ pivot_table | safe }}</div>
    <script>
      // Add edit buttons to each PO row if table is rendered
      document.addEventListener('DOMContentLoaded', function() {
        const table = document.querySelector('table');
        if (table) {
          const poNoIdx = Array.from(table.rows[0].cells).findIndex(cell => cell.textContent.trim() === 'PO No');
          if (poNoIdx !== -1) {
            // Add header for Edit
            const th = document.createElement('th');
            th.textContent = 'Edit';
            table.rows[0].appendChild(th);
            // Add edit button to each row
            for (let i = 1; i < table.rows.length; i++) {
              const poId = table.rows[i].cells[poNoIdx].textContent.trim();
              const td = document.createElement('td');
              const btn = document.createElement('a');
              btn.textContent = 'Edit';
              btn.href = '/edit_po/' + encodeURIComponent(poId);
              btn.style = 'color: blue; text-decoration: underline; cursor: pointer;';
              td.appendChild(btn);
              table.rows[i].appendChild(td);
            }
          }
        }
      });
    </script>
  </body>
</html>
